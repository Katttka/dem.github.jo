<!DOCTYPE html>
<html>
  <head>
    <title>–ú–æ—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</title>
    </head>
  <body>
    
<p>
  #!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ö—Ä–∏–ø—Ç–æ–∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—à–∞—Ç–µ–ª—å –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫
–†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–∏–¥–∞: –°–õ–û–í–û + –°–õ–û–í–û = –°–õ–û–í–û
"""

from itertools import permutations
import re
from datetime import datetime


class CryptoSolver:
    """–ö–ª–∞—Å—Å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π"""
    
    def __init__(self):
        self.total_equations = 0
        self.solved_count = 0
    
    def word_to_number(self, word, mapping):
        """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–ª–æ–≤–æ –≤ —á–∏—Å–ª–æ –ø–æ –∫–∞—Ä—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è"""
        return int(''.join(str(mapping[char]) for char in word))
    
    def parse_equation(self, equation):
        """–ü–∞—Ä—Å–∏—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ª–∞–≥–∞–µ–º—ã–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
        parts = equation.split('=')
        left_side = parts[0].strip()
        right_side = parts[1].strip()
        
        addends = re.findall(r'[–ê-–Ø–Å]+', left_side)
        result = right_side.strip()
        
        return addends, result
    
    def solve_equation(self, equation):
        """–†–µ—à–∞–µ—Ç –æ–¥–Ω–æ –∫—Ä–∏–ø—Ç–æ–∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ"""
        addends, result = self.parse_equation(equation)
        
        if not addends or not result:
            return None
        
        # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±—É–∫–≤—ã
        all_letters = set()
        for word in addends + [result]:
            all_letters.update(word)
        letters = list(all_letters)
        
        if len(letters) > 10:
            return None
        
        # –ü–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å 0
        first_letters = set(word[0] for word in addends + [result])
        
        permutations_checked = 0
        
        for perm in permutations(range(10), len(letters)):
            permutations_checked += 1
            mapping = dict(zip(letters, perm))
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –Ω–µ 0
            if any(mapping[letter] == 0 for letter in first_letters):
                continue
            
            # –í—ã—á–∏—Å–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
            addend_values = [self.word_to_number(word, mapping) for word in addends]
            result_value = self.word_to_number(result, mapping)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–∞–≤–Ω–µ–Ω–∏–µ
            if sum(addend_values) == result_value:
                return {
                    'mapping': mapping,
                    'addends': addends,
                    'addend_values': addend_values,
                    'result': result,
                    'result_value': result_value,
                    'permutations': permutations_checked,
                    'letters': letters
                }
        
        return None
    
    def print_separator(self, char='=', length=60):
        """–í—ã–≤–æ–¥–∏—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—É—é –ª–∏–Ω–∏—é"""
        print(char * length)
    
    def print_equation_header(self, num, equation):
        """–í—ã–≤–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"""
        print()
        self.print_separator('#')
        print(f"# –£–†–ê–í–ù–ï–ù–ò–ï #{num}")
        self.print_separator('#')
        print()
        self.print_separator('=')
        print(f"–£—Ä–∞–≤–Ω–µ–Ω–∏–µ: {equation}")
        print()
    
    def print_solution(self, solution, equation):
        """–ö—Ä–∞—Å–∏–≤–æ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è"""
        if not solution:
            print("‚ùå –†–ï–®–ï–ù–ò–ï –ù–ï –ù–ê–ô–î–ï–ù–û!")
            return
        
        self.print_separator('=')
        print(f"–ë—É–∫–≤—ã ({len(solution['letters'])}): {', '.join(sorted(solution['letters']))}")
        self.print_separator('=')
        print()
        print(f"‚úÖ –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û! (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫: {solution['permutations']:,})")
        print()
        print("üìã –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –±—É–∫–≤ –∏ —Ü–∏—Ñ—Ä:")
        self.print_separator('-')
        
        for letter, digit in sorted(solution['mapping'].items(), key=lambda x: x[1]):
            print(f"   {letter} = {digit}")
        
        print()
        print("üî¢ –ü—Ä–æ–≤–µ—Ä–∫–∞:")
        self.print_separator('-')
        
        # –í—ã—á–∏—Å–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
        all_values = solution['addend_values'] + [solution['result_value']]
        max_width = max(len(str(v)) for v in all_values)
        
        # –í—ã–≤–æ–¥–∏–º —Å–ª–∞–≥–∞–µ–º—ã–µ
        for i, val in enumerate(solution['addend_values']):
            if i == 0:
                print(f"    {val:>{max_width}}")
            else:
                print(f" +  {val:>{max_width}}")
        
        # –í—ã–≤–æ–¥–∏–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—É—é –ª–∏–Ω–∏—é
        print(f"   {'-' * max_width}")
        print(f"   {solution['result_value']:>{max_width}}")
        print()
        
        # –í—ã–≤–æ–¥–∏–º –∏—Ç–æ–≥–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
        addends_str = ' + '.join(map(str, solution['addend_values']))
        print(f"‚úì {addends_str} = {solution['result_value']}")
        print()
    
    def solve_all(self, equations):
        """–†–µ—à–∞–µ—Ç –≤—Å–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥–∏—Ç –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á—ë—Ç"""
        self.total_equations = len(equations)
        self.solved_count = 0
        
        print()
        self.print_separator('‚ïê', 60)
        print("   üß© –ö–†–ò–ü–¢–û–ê–†–ò–§–ú–ï–¢–ò–ß–ï–°–ö–ò–ô –†–ï–®–ê–¢–ï–õ–¨ –ì–û–õ–û–í–û–õ–û–ú–û–ö üß©")
        self.print_separator('‚ïê', 60)
        print(f"\n   –í—Å–µ–≥–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–π: {self.total_equations}")
        print(f"   –î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}")
        print()
        
        results = []
        for i, equation in enumerate(equations, 1):
            self.print_equation_header(i, equation)
            solution = self.solve_equation(equation)
            results.append(solution)
            self.print_solution(solution, equation)
            
            if solution:
                self.solved_count += 1
        
        # –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç
        self.print_separator('‚ïê', 60)
        print("   üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–Å–¢")
        self.print_separator('‚ïê', 60)
        print()
        print(f"   ‚úÖ –†–µ—à–µ–Ω–æ —É—Ä–∞–≤–Ω–µ–Ω–∏–π: {self.solved_count} –∏–∑ {self.total_equations}")
        print(f"   üìà –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {(self.solved_count/self.total_equations)*100:.1f}%")
        print()
        
        if self.solved_count == self.total_equations:
            print("   üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í—Å–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã!")
        else:
            print("   ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –Ω–µ –∏–º–µ—é—Ç —Ä–µ—à–µ–Ω–∏—è")
        print()
        self.print_separator('‚ïê', 60)
        print()
        
        return results


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    solver = CryptoSolver()
    
    # –í—Å–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è
    equations = [
        "–í–û–õ–ö + –õ–ò–°–ê = –ó–í–ï–†–ò",
        "–ö–¢–û + –ö–û–¢ = –¢–û–ö",
        "–ö–û–®–ö–ê + –ö–û–®–ö–ê + –ö–û–®–ö–ê = –°–û–ë–ê–ö–ê",
        "–°–ò–ù–£–° + –°–ò–ù–£–° + –ö–û–°–ò–ù–£–° = –¢–ê–ù–ì–ï–ù–°"
    ]
    
    solver.solve_all(equations)


if __name__ == "__main__":
    main()
</p>
